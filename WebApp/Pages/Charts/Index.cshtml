@page
@model WebApp.Pages.Charts.IndexModel
@{
    ViewData["Title"] = "Charts";
}
<html>
<head>
    <style>
            .table__container {
                width: calc(100% + 24px);
                margin-top: 20px;
                margin-left: -12px;
                margin-right: -12px;
            }

            .table__container table {
                width: 100%;
            }

            .table__container table th {
                border: 2px solid black
            }

            .table__container table td {
                border: 1px solid black
            }
    </style>
</head>
<body>

        <form>
            <p>
                 <select name="FilterCriteria" id="FilterCriteria" asp-for="FilterCriteria">
                    <option value="1">User 1</option>
                    <option value="2">User 2</option>
                    <option value="3">User 3</option>
                </select>
                <input type="submit" value="Submit"/>
            </p>
        </form>

    <div class="text-left">
        <h1 class="display-4">
            Charts
        </h1>
        <br/>
        <h2 class="text-left">
            Power Usage
        </h2>
        <hr/>
    </div>


    <div>
        <div style="width: 100%; display: flex; justify-content: space-between;">
            <div style="width: 30%;" class="row">
                <h3 class="text-left">Last 30 days</h3>
                <canvas id="pieChart" style="
                border: 1px solid black;"></canvas>
            </div>
            <div style="width: 60%; height: 20%;" class="row">
                <h3 class="text-left">
                    Previous 3 months
                </h3>
                <canvas id="barChart" style="
                    border: 1px solid black;"
                ></canvas>
            </div>
        </div>
        <div class="table__container">
            Monthly Breakdown
               <table>
                   <thead>
                      <th>Month</th>
                      <th>Usage</th>
                      <th>Generation</th>
                      <th>Difference</th>
                   </thead>
                   <tbody>
                       @if (Model.PowerUse.Count != 0)
                       {
                            @foreach (var item in Model.PowerUse)
                            {
                                <tr>
                                    <td>
                                        @item.Period.Month 
                                    </td>
                                    <td style="color:red">
                                        <b>
                                          @item.UsedkWh/kWh
                                        </b>
                                    </td>
                                    <td style="color:green">
                                       <b>
                                          @item.ProducedkWh/kWh
                                       </b>
                                    </td>
                                    <td>
                                        @(item.UsedkWh - item.ProducedkWh)/kWh
                                    </td>
                                </tr>
                            }
                       }
                </tbody>

@*                    <tbody>
                   <tr>
                       <td>December</td>
                       <td>2</td>
                       <td>3</td>
                       <td>4</td>
                   </tr>
                   <tr>
                       <td>November</td>
                       <td>2</td>
                       <td>3</td>
                       <td>4</td>
                   </tr>
                   <tr>
                       <td>October</td>
                       <td>2</td>
                       <td>3</td>
                       <td>4</td>
                   </tr>
                   <tr>
                       <td>September</td>
                       <td>2</td>
                       <td>3</td>
                       <td>4</td>
                   </tr>
                   </tbody> *@
               </table>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        const ctx = document.getElementById('pieChart');
        const pChart = document.getElementById('barChart')

        function getRandomInt(max) {
            return Math.floor(Math.random() * max);
        }

        new Chart(ctx, {
            type: 'pie',
            data: {
                labels: ['kW/h - Used', 'kW/h - Generated'],
                datasets: [{
                    label: 'kW/h',
                    data: [getRandomInt(200) + 50, getRandomInt(200) + 50],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        aUsed = getRandomInt(200) + 50;
        aGen = getRandomInt(200) + 50;

        bUsed = getRandomInt(200) + 50;
        bGen = getRandomInt(200) + 50;

        cUsed = getRandomInt(200) + 50;
        cGen = getRandomInt(200) + 50;

        new Chart(pChart, {
            type: 'bar',
            data: {
                labels: ['2023/06', '2023/07', '2023/08'],
                datasets: [{
                    label: 'Used kW/h',
                    data: [aUsed, bUsed, cUsed],
                    borderWidth: 1
                },
                {
                    label: 'Generated kW/h',
                    data: [aGen, bGen, cGen],
                    borderWidth: 1
                },
                {
                    label: 'Difference in kW/h',
                    data: [aGen - aUsed, bGen - bUsed, cGen - cUsed],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    </script>
</body>
</html>
